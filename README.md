# 📊 Activity Tracker Bot - 員工活動追蹤機器人

[![Node.js](https://img.shields.io/badge/Node.js-14+-green.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Telegram Bot](https://img.shields.io/badge/Telegram-Bot-blue.svg)](https://core.telegram.org/bots)

一個功能強大的 Telegram 機器人，用於追蹤和管理員工的日常活動，提供詳細的統計分析、網頁儀表板和自動化 Excel 報告功能。

## 🌟 主要功能

### 📱 Telegram Bot 功能
- **智能活動追蹤** - 支援多種活動類型（上廁所、抽菸、大便、使用手機等）
- **直觀操作介面** - 一鍵式按鈕操作，簡單易用
- **即時狀態監控** - 實時追蹤活動狀態，自動超時警告
- **多群組管理** - 同時支援多個聊天群組的獨立管理
- **智能提醒系統** - 接近超時和超時自動通知

### 🌐 詳細網頁數據面板
- **即時數據展示** - 30秒自動刷新的動態儀表板
- **員工效率分析** - 詳細的個人表現評分和統計
- **多時段查詢** - 支援今日、昨日、本週、上週、本月、上月查詢
- **響應式設計** - 完美支援桌面和行動裝置
- **即時活動監控** - 實時顯示正在進行的活動狀態

### 📊 專業 Excel 報告系統
- **6個詳細工作表** - 全面涵蓋各種統計需求
- **視覺化分析** - 熱力圖、顏色編碼、專業圖表
- **自動存檔機制** - 每日 23:00 自動生成並保存報告
- **智能檔案管理** - 按年月分類，90天自動清理

### ⏰ 全自動定時任務
- **每日報告生成** - 自動生成前一天完整活動報告
- **Excel 自動存檔** - 每日為所有群組生成 Excel 報告存檔
- **資料自動清理** - 清理過期數據和檔案，維持系統效能
- **系統健康檢查** - 每小時監控系統狀態

## 🚀 快速開始

### ✅ 環境要求
- Node.js 14.0 或更高版本
- npm 套件管理器
- Telegram Bot Token

### 📦 安裝步驟

1. **下載專案**
   ```bash
   git clone https://github.com/godmakereth/activity_tracker_bot.git
   cd activity_tracker_bot
   ```

2. **安裝依賴套件**
   ```bash
   npm install
   ```

3. **設定 Telegram Bot Token**
   - 在 Telegram 中找到 @BotFather
   - 建立新的 Bot 並獲取 Token
   - 將 Token 填入 `start-final.js` 檔案中

4. **啟動系統**
   ```bash
   npm start
   ```

### 🎯 立即使用

**Telegram Bot:**
- 將 Bot 添加到您的工作群組
- 發送 `/start` 開始使用
- 點擊按鈕進行活動追蹤

**網頁數據面板:**
- 瀏覽器訪問: http://localhost:3000
- 選擇群組和時間範圍查看統計
- 下載 TXT 或 Excel 報告

## 📊 Excel 報告功能詳解

### 🎨 6個專業工作表

#### 1. 📊 總覽統計
- **群組整體數據** - 員工總數、活動次數、總時間統計
- **活動類型分析** - 各類活動的使用頻率和參與人數
- **效率指標** - 超時比例、平均活動時間等關鍵指標

#### 2. 👥 員工詳細統計
- **效率評分** - 基於超時率的智能評分系統 (綠色≥80%, 橙色≥60%, 紅色<60%)
- **個人表現** - 總活動次數、平均時間、超時統計
- **出勤分析** - 活動天數、最常用活動類型

#### 3. 📊 活動明細
- **詳細分解** - 每位員工每種活動的完整數據
- **時間統計** - 平均、最長、最短活動時間
- **超時分析** - 超時次數和超時時間統計

#### 4. 🕐 時段分析 (熱力圖)
- **24小時分佈** - 活動在一天中的分佈情況
- **視覺化呈現** - 顏色深淺表示活動頻率
- **模式識別** - 找出活動高峰時段

#### 5. 🔴 即時狀態
- **當前活動** - 報告生成時正在進行的活動
- **狀態評估** - 正常(綠)、警告(橙)、超時(紅)狀態標示
- **風險提示** - 即時的活動狀態監控

#### 6. 📅 日期分析
- **每日分佈** - 統計期間內每天的活動次數
- **趨勢分析** - 活動頻率的日期變化趨勢
- **工作模式** - 工作日活動模式識別

### ✨ 專業視覺化特色
- **智能色彩編碼** - 效率和狀態的直觀顏色表示
- **熱力圖效果** - 活動強度的漸變顯示
- **專業格式化** - 完整的表格邊框、字體樣式
- **中文本地化** - 100% 繁體中文介面

## 🌐 網頁數據面板功能

### 📋 主控制台
- **群組選擇** - 下拉選單選擇要查看的群組
- **時間範圍** - 今日/昨日/本週/上週/本月/上月
- **即時更新** - 30秒自動刷新，確保數據最新

### 📊 統計卡片
- **👥 總員工數** - 群組內員工總數統計
- **📊 總活動次數** - 所選時間範圍內的活動總數
- **⏱️ 總活動時間** - 所有活動的累計時間
- **🔴 目前活動中** - 即時顯示正在活動的員工數

### 👤 員工詳細卡片
- **效率評分顯示** - 彩色徽章顯示效率等級
- **個人統計數據** - 活動次數、總時間、平均時間
- **超時分析** - 超時次數和出勤天數
- **詳細頁面連結** - 點擊查看個人完整數據

### 🔴 即時活動監控
- **活動中員工列表** - 目前正在進行活動的員工
- **狀態指示器** - 正常(綠)、警告(橙)、超時(紅)
- **持續時間** - 實時更新的活動持續時間

### 📄 報告下載功能
- **📄 TXT 報告** - 詳細的文字格式報告
- **📊 Excel 報告** - 專業的 Excel 分析報告
- **🖨️ 列印功能** - 直接列印當前頁面

## 🔄 自動存檔系統

### 📅 存檔時程
- **觸發時間** - 每日 23:00 自動執行
- **資料範圍** - 前一天 00:00-23:59 的完整數據
- **存檔對象** - 所有活躍群組的獨立報告

### 📁 檔案結構
```
./archives/excel/
├── 2025/
│   ├── 01/
│   │   ├── 群組A_2025-01-01.xlsx
│   │   ├── 群組B_2025-01-01.xlsx
│   │   └── ...
│   ├── 02/
│   └── 03/
├── 2026/
└── archive_log.json (存檔操作記錄)
```

### 🧹 智能清理機制
- **保留期限** - 90天自動保留
- **清理範圍** - 過期 Excel 檔案和空目錄
- **日誌維護** - 保留最新 1000 條操作記錄
- **空間優化** - 自動清理確保儲存空間

## ⚙️ 系統配置

### 📝 活動類型設定
| 活動類型 | 中文名稱 | 標準時間限制 | 超時警告 |
|---------|---------|-------------|---------|
| toilet | 🚽 上廁所 | 6分鐘 | 70%時提醒 |
| smoking | 🚬 抽菸 | 5分鐘 | 70%時提醒 |
| poop_10 | 💩 大便(10分) | 10分鐘 | 70%時提醒 |
| poop_15 | 💩 大便(15分) | 15分鐘 | 70%時提醒 |
| phone | 📱 使用手機 | 10分鐘 | 70%時提醒 |

### ⏰ 定時任務設定
| 任務類型 | 執行時間 | 功能說明 |
|---------|---------|---------|
| 每日報告 | 23:00 | 生成前一天活動總結 |
| Excel存檔 | 23:00 | 自動保存Excel報告 |
| 資料清理 | 02:00 | 清理過期數據檔案 |
| 健康檢查 | 每小時 | 監控系統運行狀態 |

### 🌐 Web服務設定
- **預設埠口** - 3000
- **自動刷新** - 30秒間隔
- **跨域支援** - CORS已設定
- **回應格式** - JSON API

## 🛠️ 開發與自訂

### 📂 專案結構
```
src/
├── application/          # 應用層
│   ├── use-cases/       # 業務用例
│   └── services/        # 應用服務
├── infrastructure/      # 基礎設施層
│   ├── database/        # 資料存儲 (JSON檔案)
│   ├── web/            # Web服務 (Express)
│   ├── excel/          # Excel處理 (ExcelJS)
│   ├── file-system/    # 檔案系統管理
│   ├── scheduling/     # 定時任務 (node-cron)
│   └── telegram/       # Telegram Bot API
├── domain/             # 領域層
│   ├── entities/       # 實體物件
│   └── value-objects/  # 值物件
└── shared/             # 共用層
    ├── config/         # 組態設定
    ├── constants/      # 常數定義
    ├── exceptions/     # 例外處理
    └── DependencyContainer.js # 依賴注入
```

### 🔧 開發指令
```bash
# 開發模式 (自動重啟)
npm run dev

# 執行測試
npm test

# 生產環境啟動
npm start
```

### 🎨 自訂修改指南

#### 新增活動類型
1. 修改 `src/shared/constants/ActivityTypes.js`
2. 更新 Bot 鍵盤設定
3. 調整 Excel 生成器的活動名稱對應

#### 修改時間限制
1. 編輯活動類型常數中的時間設定
2. 更新超時檢查邏輯
3. 調整警告提醒閾值

#### 自訂報告格式
1. 擴展 `ExcelReportGenerator.js` 中的工作表
2. 修改網頁面板的顯示邏輯
3. 更新 API 回應格式

## 🔒 安全性考量

### 🛡️ 資料安全
- **最小化資料收集** - 僅記錄必要的活動資訊
- **本地存儲** - 所有資料存儲在本地JSON檔案
- **存取控制** - 網頁面板可配置存取限制
- **定期備份** - 建議定期備份重要資料檔案

### 🔐 系統安全
- **環境變數管理** - 敏感設定透過環境變數保護
- **錯誤處理** - 完善的異常處理和日誌記錄
- **輸入驗證** - 所有使用者輸入都經過驗證
- **API安全** - Web API具備基本的安全防護

## 🐛 問題排解

### ❓ 常見問題

**Q: Bot 無法回應指令？**
- 檢查 `start-final.js` 中的 Token 設定
- 確認 Bot 已加入群組並有適當權限
- 查看控制台是否有錯誤訊息

**Q: 網頁面板無法開啟？**
- 確認應用程式已成功啟動
- 檢查 3000 埠口是否被其他程式占用
- 確認防火牆設定允許該埠口

**Q: Excel 報告無法下載？**
- 確認 ExcelJS 套件已正確安裝
- 檢查檔案系統權限設定
- 查看瀏覽器是否阻擋下載

**Q: 自動存檔失敗？**
- 檢查 `./archives/excel/` 目錄權限
- 確認磁碟空間充足
- 查看 `archive_log.json` 中的錯誤記錄

### 📋 系統檢查清單
- [ ] Node.js 版本 ≥ 14.0
- [ ] 所有 npm 套件已安裝
- [ ] Telegram Bot Token 設定正確
- [ ] 必要目錄已建立且有寫入權限
- [ ] 3000 埠口可正常使用

## 📊 效能最佳化

### ⚡ 系統效能
- **記憶體管理** - 定期重啟長時間運行的服務
- **資料清理** - 定期清理過期的活動記錄
- **檔案管理** - 90天自動清理機制
- **API最佳化** - 合理控制 Telegram API 呼叫頻率

### 📈 擴展性建議
- **水平擴展** - 支援多實例部署
- **資料分離** - 可設定不同的資料存儲方案
- **微服務架構** - 模組化設計便於功能拆分
- **負載平衡** - 大型部署可考慮負載平衡

## 🤝 貢獻與支援

### 🐛 問題回報
1. 使用 GitHub Issues 提交問題
2. 提供詳細的重現步驟和環境資訊
3. 附上相關的錯誤日誌和截圖

### 💡 功能建議
1. 在 Issues 中標記 'enhancement'
2. 詳細描述功能需求和使用場景
3. 提供任何相關的參考資料

### 🔧 程式碼貢獻
1. Fork 專案到您的 GitHub 帳戶
2. 建立功能分支進行開發
3. 遵循現有的程式碼風格
4. 提交 Pull Request 並等待審查

## 📄 授權資訊

本專案採用 MIT 授權條款 - 詳見 [LICENSE](LICENSE) 檔案

## 👥 開發團隊

- **godmakereth** - 主要開發者 - [GitHub](https://github.com/godmakereth)

## 🙏 特別感謝

感謝以下優秀的開源專案：
- [node-telegram-bot-api](https://github.com/yagop/node-telegram-bot-api) - Telegram Bot API
- [ExcelJS](https://github.com/exceljs/exceljs) - Excel 檔案處理
- [Express.js](https://expressjs.com/) - Web 框架
- [node-cron](https://github.com/node-cron/node-cron) - 定時任務調度
- [moment-timezone](https://momentjs.com/timezone/) - 時區處理

---

## 🎯 快速操作指南

### 📱 Telegram 操作
1. 將 Bot 加入工作群組
2. 發送 `/start` 初始化
3. 點擊活動按鈕開始追蹤
4. 自動或手動結束活動

### 🌐 網頁操作
1. 開啟 http://localhost:3000
2. 選擇群組和時間範圍
3. 查看即時統計和員工表現
4. 下載 TXT 或 Excel 報告

### 📊 Excel 分析
1. 下載的 Excel 包含 6 個工作表
2. 查看總覽瞭解整體狀況
3. 分析員工詳細找出表現優異者
4. 利用時段分析優化工作安排

**技術支援**: 請在 GitHub Issues 提出問題  
**喜歡此專案**: 請給我們一個 ⭐ Star!

---
*最後更新: 2025-07-11*